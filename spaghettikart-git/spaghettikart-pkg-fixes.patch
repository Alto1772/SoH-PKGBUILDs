From 0986d7291969dbb55b38977b68e3580842d629d8 Mon Sep 17 00:00:00 2001
From: AltoXorg <56553686+Alto1772@users.noreply.github.com>
Date: Mon, 29 Dec 2025 19:14:41 +0800
Subject: [PATCH] Fix runtime crash by moving LocateFileAcrossAppDirs inside
 function

---
 src/engine/mods/ModManager.cpp | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/engine/mods/ModManager.cpp b/src/engine/mods/ModManager.cpp
index a94d8f558..9315acca8 100644
--- a/src/engine/mods/ModManager.cpp
+++ b/src/engine/mods/ModManager.cpp
@@ -19,8 +19,6 @@ void DetectOutdatedDependencies();
 void SortModsByDependencies();
 
 std::vector<std::tuple<ModMetadata, std::shared_ptr<Ship::Archive>>> Mods = {};
-const std::string main_path = Ship::Context::GetPathRelativeToAppDirectory("mk64.o2r");
-const std::string assets_path = Ship::Context::LocateFileAcrossAppDirs("spaghetti.o2r");
 
 void InitModsSystem() {
     CheckMK64O2RExists();
@@ -65,6 +63,9 @@ void GenerateAssetsMods() {
 }
 
 std::vector<std::string> ListMods() {
+    const std::string main_path = Ship::Context::GetPathRelativeToAppDirectory("mk64.o2r");
+    const std::string assets_path = Ship::Context::LocateFileAcrossAppDirs("spaghetti.o2r");
+
     std::vector<std::string> archiveFiles;
     if (std::filesystem::exists(main_path)) {
         archiveFiles.push_back(main_path);
@@ -202,6 +203,8 @@ void AddCoreDependencies() {
 }
 
 void CheckMK64O2RExists() {
+    const std::string main_path = Ship::Context::GetPathRelativeToAppDirectory("mk64.o2r");
+
     if (!std::filesystem::exists(main_path)) {
         GenerateAssetsMods();
     }
-- 
2.52.0

